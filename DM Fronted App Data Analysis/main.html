<!DOCTYPE html>

<html>

<head>
<title>DM Data Factory</title>
<script type="text/javascript" src="code.js"></script>
<link rel="stylesheet" href="styling.css" type="text/css">

</head>
<body>

<div class="progresscon">
    <div class="bar"> 

        <a class="status" id="status"></a>

    </div>
</div>

<div id="main" class="hcon">
 

<img src="res/logo.jpg" class="logo">

<div class="con">
    <h1>Data Managment</h1>
    <p>Analyse Your Data Quality</p>
</div>
    
</div>



<div class="sep"></div>


    <div class="cont">
       
        <input id="input" type="file"> 

 
    <div class="sep"></div>
  
       
    </div>


<div class="con">
<p>Supports .CSV files only</p>
</div>





<script type="text/javascript">
    function delimeterchecck(data=""){


      var result = 0;
        
      
      var num = data.split("\n")[0].split(',').length;
      data.split('\n').forEach((line,index,arry)=>{
        if(line.split(',').length>num){
            result = 1;
        }
        
      });

      return result
    }

    function type(data=""){

var blank = new RegExp(/^(\s)*$/,'gm');
var decimal = new RegExp(/^\d*\.\d*$/,'gm');
var number = new RegExp(/^\d*$/,'gm');
var date = new RegExp(/^((([0-2][0-9]|[3][0-1])|([1-9]))\/(([0][1-9]|[1][0-2])|([1-9]))\/[1-2]([9]|[0])[0-9][0-9])|((([0-2][0-9]|[3][0-1])|([1-9]))-(([0][1-9]|[1][0-2])|([1-9]))-[1-2]([9]|[0])[0-9][0-9])$/,'gm');
var datetime = new RegExp(/^(((([0-2][0-9]|[3][0-1])|([1-9]))\/(([0][1-9]|[1][0-2])|([1-9]))\/[1-2]([9]|[0])[0-9][0-9])|((([0-2][0-9]|[3][0-1])|([1-9]))-(([0][1-9]|[1][0-2])|([1-9]))-[1-2]([9]|[0])[0-9][0-9]))\s\s((([0][1-9]|[1][0-1]):([0-5][0-9]):([0-5][0-9])\s(AM|PM)|(12:00:00\s(AM|PM)))|((24:00:00)|(00:00:00)|((([0][1-9])|([1][0-9])|([2][0-3])):([0-5][0-9]):([0-5][0-9]))))$/,'gm');
var time = new RegExp(/^((([0][1-9]|[1][0-1]):([0-5][0-9]):([0-5][0-9])\s(AM|PM)|(12:00:00\s(AM|PM)))|((24:00:00)|(00:00:00)|((([0][1-9])|([1][0-9])|([2][0-3])):([0-5][0-9]):([0-5][0-9]))))$/,'gm')
var text = new RegExp(/^\D.*$/,'gm');
var string = new RegExp(/^.*$/);


var final = "";

if(blank.test(data)){
final = "Blank";
}
else{
if(decimal.test(data)){
final = "Decimal";
}else{
if(number.test(data)){
    final = "Number";
}else{
    if(date.test(data)){
        final = "Date";
    }else{
        if(datetime.test(data)){
            final = "DateTime";
        }else{
            if(time.test(data)){
                final = "Time";
            }else{
                if(text.test(data)){
                    final = "Text";
                }else{
                    if(string.test(data)){
                        final = "String";
                    }else{

                        final = "other";
                    }

                }
            }
        }
    }
}
}
}


return final;
}



</script>
<script type="text/javascript">





/*
document.body.onclick = ()=>{

    var barchart = document.createElement('div');
    barchart.setAttribute('class','barchart');
    barchart.style.width = '50px';
    barchart.style.height = '10px';
    barchart.style.backgroundColor = 'gray';
   barchart.style.position = 'relative';
    var idnicator = document.createElement('div');
    idnicator.setAttribute('class','indicator');
    idnicator.style.width = '35px';
    idnicator.style.height = '100%';
    idnicator.style.backgroundColor = 'black';
    idnicator.style.animation = 'bar 2s forwards'
  idnicator.style.position = 'absolute';
  barchart.appendChild(idnicator); 

    document.body.appendChild(barchart);
  
    
}

*/



    var blank = new RegExp(/^(\s)*$/,'gm');
    var decimal = new RegExp(/^\d*\.\d*$/,'gm');
    var number = new RegExp(/^\d*$/,'gm');
    var date = new RegExp(/^((([0-2][0-9]|[3][0-1])|([1-9]))\/(([0][1-9]|[1][0-2])|([1-9]))\/[1-2]([9]|[0])[0-9][0-9])|((([0-2][0-9]|[3][0-1])|([1-9]))-(([0][1-9]|[1][0-2])|([1-9]))-[1-2]([9]|[0])[0-9][0-9])$/,'gm');
    var datetime = new RegExp(/^(((([0-2][0-9]|[3][0-1])|([1-9]))\/(([0][1-9]|[1][0-2])|([1-9]))\/[1-2]([9]|[0])[0-9][0-9])|((([0-2][0-9]|[3][0-1])|([1-9]))-(([0][1-9]|[1][0-2])|([1-9]))-[1-2]([9]|[0])[0-9][0-9]))\s\s((([0][1-9]|[1][0-1]):([0-5][0-9]):([0-5][0-9])\s(AM|PM)|(12:00:00\s(AM|PM)))|((24:00:00)|(00:00:00)|((([0][1-9])|([1][0-9])|([2][0-3])):([0-5][0-9]):([0-5][0-9]))))$/,'gm');
    var time = new RegExp(/^((([0][1-9]|[1][0-1]):([0-5][0-9]):([0-5][0-9])\s(AM|PM)|(12:00:00\s(AM|PM)))|((24:00:00)|(00:00:00)|((([0][1-9])|([1][0-9])|([2][0-3])):([0-5][0-9]):([0-5][0-9]))))$/,'gm')
    var text = new RegExp(/^\D.*$/,'gm');
    var string = new RegExp(/^.*$/);
var bar = document.querySelector(".bar")
var upload = document.body.querySelector('input');
var selector = document.getElementById('input');
var filereader = new FileReader();
var data = "";



selector.onclick=()=>{
   bar.removeAttribute('id');
   document.getElementById('status').innerText = '';
   document.getElementById('table').remove();
   filereader.abort();   
  

}
selector.ondrop=()=>{
   bar.removeAttribute('id');
    document.getElementById('status').innerText = '';
    document.getElementById('table').remove();
    filereader.abort();


}
selector.onchange = (e) =>{
    
        filereader.readAsText(upload.files[0],'utf-8')

        filereader.onload = (e)=>{
            
       

        }
     
filereader.onprogress = ()=> {
    document.getElementById('status').innerText = 'In Progress ...';
   
}

        filereader.onloadend = (e)=>{
            bar.setAttribute('id','filebar');
            data = "";
            data = filereader.result;


           if (delimeterchecck(data)!=0) {
            document.getElementById('status').innerText = 'Failed with Delimeter check';
           }else{
            document.getElementById('status').innerText = 'Loaded Successfully';
           }


    
           var attributes = data.split("\n")[0].split(",");
    
      
           
           var table = document.createElement('div');
                table.setAttribute('class','table');
                table.setAttribute('id','table');
                table.style.animation = 'bar 2s forwards'

                

                document.body.appendChild(table);
            var row = document.createElement('div');

            row.setAttribute('class','row');

       

            data.split('\n')[0].split(",").forEach((v,i,a)=>{



var size = data.split('\n').length-1;
var blankcount = 0;
var decimalcount = 0;
var numbercount = 0;
var datecount = 0;
var datetimecount = 0;
var timecount = 0;
var textcount = 0;
var stringcount = 0;
var anycount = 0;
var calc = "";


                data.split('\n').forEach((v2,i2,a2)=>{
                    var value = v2.split(',')[i];
                    if(v2[v2.length-1]=='\r'){
                        value = v2.split('\r')[0].split(',')[i]; 
                    }else{
                     value = v2.split(',')[i];
                       }
                    
console.log(value+" | "+type(value));
                   
                    
if(i2!=0){

    if(type(value)=='Blank'){
        blankcount++
    }else{
        
    if(type(value)=='Decimal'){
        decimalcount++
    }else{
        if(type(value)=='Number'){
        numbercount++
    }else{
        
    if(type(value)=='Date'){
        datecount++
    }else{
        if(type(value)=='DateTime'){
        datetimecount++
    }else{
        
    if(type(value)=='Time'){
        timecount++
    }else{
        if(type(value)=='Text'){
        textcount++
    }else{
        
    if(type(value)=='String'){
        stringcount++
    }else{
        if(type(value)=='other'){
        anycount++
    }
    }
    }
    }
    }
    }
    }
    }
    }


}




            });

            
       
            ///chart
            
    var barchart = document.createElement('div');
    barchart.setAttribute('class','barchart');
    barchart.style.width = '50px';
    barchart.style.height = '10px';
    barchart.style.backgroundColor = 'gray';
   barchart.style.position = 'relative';
    var idnicator = document.createElement('div');
    idnicator.setAttribute('class','indicator');
    idnicator.style.width = '0px';
    idnicator.style.height = '100%';
    idnicator.style.backgroundColor = 'black';
  idnicator.style.position = 'absolute';
  idnicator.style.animation = 'bar1 2s forwards'
  barchart.appendChild(idnicator); 

  var sep = document.createElement('div');
  sep.setAttribute('class','divs');
  sep.style.padding = '4px';
  sep.style.margin = '10px';
  sep.style.color = 'white';
  sep.style.height = '100%';
  sep.style.width = '20%';
  sep.style.textAlign = 'center'
  sep.style.backgroundColor = 'gray';
  sep.style.borderRadius = '4px 4px 4px 4px';
  sep.style.display = 'inline-block';
 



            //chart
            row.innerHTML = "";
            calc = "";           

sep.innerHTML=data.split('\n')[0].split(",")[i]+"   ";
table.appendChild(sep);

calc+=` Blanks: `;
row.innerHTML += calc;
row.appendChild(barchart);
calc= ` ${Math.round((blankcount/size)*100)}%  `;
idnicator.style.setProperty('--widthchange',calc);
row.innerHTML += calc;
calc = ` Decimal: `;
row.innerHTML += calc;
row.appendChild(barchart);
calc = ` ${Math.round((decimalcount/size)*100)}%;  `;
idnicator.style.setProperty('--widthchange',calc);

row.innerHTML += calc;
calc = `Numbers: `;
row.innerHTML += calc;
row.appendChild(barchart);
calc = ` ${Math.round((numbercount/size)*100)}%  `;
idnicator.style.setProperty('--widthchange',calc);

row.innerHTML += calc;
calc = `Date: `;
row.innerHTML += calc;
row.appendChild(barchart);
calc = ` ${Math.round((datecount/size)*100)}%  `;
idnicator.style.setProperty('--widthchange',calc);

row.innerHTML += calc;
calc = `DateTime: `;
row.innerHTML += calc;
row.appendChild(barchart);;
calc = ` ${Math.round((datetimecount/size)*100)}%  `;
idnicator.style.setProperty('--widthchange',calc);

row.innerHTML += calc;
calc = `Time: `;
row.innerHTML += calc;
row.appendChild(barchart);
calc =  ` ${Math.round((timecount/size)*100)}%  `;
idnicator.style.setProperty('--widthchange',calc);

row.innerHTML += calc;
calc = `Text: `;
row.innerHTML += calc;
row.appendChild(barchart);
calc = ` ${Math.round((textcount/size)*100)}%  `;
idnicator.style.setProperty('--widthchange',calc);

row.innerHTML += calc;
calc = `String: `;
row.innerHTML += calc;
row.appendChild(barchart);
calc =  ` ${Math.round((stringcount/size)*100)}%  `;
idnicator.style.setProperty('--widthchange',calc);

row.innerHTML += calc;
calc = `Any: `;
row.innerHTML += calc;
row.appendChild(barchart);
calc = ` ${Math.round((anycount/size)*100)}%  `;
idnicator.style.setProperty('--widthchange',calc);

row.innerHTML += calc;
//calc+=`${blankcount},${decimalcount},${numbercount},${datecount},${datetimecount},${timecount},${textcount},${stringcount},${anycount}`




                table.appendChild(row.cloneNode(true));
               
                
            });
                        
                        
        }
       
    
    }







</script>

</body>
</html>